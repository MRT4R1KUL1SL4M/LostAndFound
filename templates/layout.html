<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CampusFind{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- AlpineJS for dropdowns -->
    <script src="//unpkg.com/alpinejs" defer></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .alert-fade { animation: fadeOut 5s forwards; }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; display: none; } }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">
    <header class="bg-gray-800/80 backdrop-blur-lg border-b border-gray-700 sticky top-0 z-50">
        <nav class="container mx-auto px-4 lg:px-6 py-3 flex justify-between items-center">
            <a href="{{ url_for('index') }}" class="text-2xl font-bold text-teal-400">CampusFind</a>
            <div class="flex items-center space-x-4">
                {% if session.logged_in %}
                    <a href="{{ url_for('index') }}" class="text-gray-300 hover:text-teal-400 font-medium hidden sm:block">Home</a>
                    <a href="{{ url_for('dashboard') }}" class="text-gray-300 hover:text-teal-400 font-medium">Dashboard</a>
                    <a href="{{ url_for('inbox') }}" class="text-gray-300 hover:text-teal-400 font-medium">Messages</a>
                    
                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open" class="relative text-gray-300 hover:text-teal-400 font-medium flex items-center space-x-1.5">
                            <span>Notifications</span>
                            {% if unread_count > 0 %}
                            <span class="bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">
                                {{ unread_count }}
                            </span>
                            {% endif %}
                        </button>
                        <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-80 bg-gray-800 rounded-md shadow-lg border border-gray-700">
                            <div class="p-3 font-semibold text-white border-b border-gray-700">Notifications</div>
                            <div class="divide-y divide-gray-700 max-h-80 overflow-y-auto">
                                {% for notification in notifications %}
                                <a href="{{ url_for('mark_notification_read', notification_id=notification.id) }}" class="block p-3 hover:bg-gray-700/50 {% if not notification.is_read %}bg-teal-900/20{% endif %}">
                                    <div class="flex items-start space-x-3">
                                        <div class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center mt-1
                                            {% if 'claim' in notification.message|lower %} bg-yellow-500/20 text-yellow-300
                                            {% elif 'message' in notification.message|lower %} bg-blue-500/20 text-blue-300
                                            {% else %} bg-green-500/20 text-green-300 {% endif %}">
                                            <i class="fa 
                                                {% if 'claim' in notification.message|lower %} fa-gavel
                                                {% elif 'message' in notification.message|lower %} fa-comment-dots
                                                {% else %} fa-bell {% endif %}"></i>
                                        </div>
                                        <div class="flex-grow">
                                            <p class="text-sm text-gray-300">{{ notification.message }}</p>
                                            <p class="text-xs text-gray-500 mt-1">{{ notification.created_at | bst }}</p>
                                        </div>
                                    </div>
                                </a>
                                {% else %}
                                <p class="p-4 text-sm text-center text-gray-500">You have no notifications.</p>
                                {% endfor %}
                            </div>
                            <div class="p-2 bg-gray-900/50 text-center">
                                <a href="{{ url_for('notifications') }}" class="text-sm font-medium text-teal-400 hover:underline">View All Notifications</a>
                            </div>
                        </div>
                    </div>

                    {% if session.role == 'admin' %}
                        <a href="{{ url_for('admin_dashboard') }}" class="text-gray-300 hover:text-teal-400 font-medium">Admin</a>
                    {% endif %}
                    <a href="{{ url_for('logout') }}" class="bg-teal-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-teal-700">Logout</a>
                {% else %}
                    <a href="{{ url_for('login') }}" class="text-gray-300 hover:text-teal-400 font-medium">Login</a>
                    <a href="{{ url_for('register') }}" class="bg-teal-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-teal-700">Create Account</a>
                {% endif %}
            </div>
        </nav>
    </header>

    <!-- Flash Messages -->
    <div class="fixed top-20 right-5 z-50 w-full max-w-sm">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert-fade px-4 py-3 rounded-lg relative mb-4 shadow-lg
                    {% if category == 'danger' %} bg-red-500/20 border border-red-500/30 text-red-300
                    {% elif category == 'success' %} bg-green-500/20 border border-green-500/30 text-green-300
                    {% else %} bg-blue-500/20 border border-blue-500/30 text-blue-300 {% endif %}"
                    role="alert">
                    <span class="block sm:inline">{{ message }}</span>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    </div>

    <main class="container mx-auto p-4 lg:p-6 min-h-screen">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-gray-800 border-t border-gray-700 mt-12">
        <div class="container mx-auto py-6 px-4 text-center text-gray-500">
            <!-- UPDATED FOOTER -->
            <p>Developed by <strong class="font-semibold text-teal-400">Tarikul Islam</strong> &copy; 2025</p>
        </div>
    </footer>
    
    <script>
        // Auto-hide alerts
        setTimeout(() => {
            document.querySelectorAll('.alert-fade').forEach(alert => {
                alert.style.display = 'none';
            });
        }, 5000);
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
