{% extends "layout.html" %}
{% block title %}My Dashboard - CampusFind{% endblock %}

{% block content %}
<div x-data="{ activeTab: 'reported' }">
    <div class="flex flex-wrap justify-between items-center mb-8 gap-4">
        <h1 class="text-3xl font-bold text-white">My Dashboard</h1>
        <div class="flex space-x-4">
            <a href="{{ url_for('new_lost_alert') }}" class="bg-yellow-600 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-yellow-700 shadow-lg flex items-center space-x-2 transition-transform transform hover:-translate-y-0.5">
                <i class="fa fa-bell"></i>
                <span>Create Lost Alert</span>
            </a>
            <a href="{{ url_for('report_item') }}" class="bg-teal-600 text-white px-5 py-2.5 rounded-lg font-semibold hover:bg-teal-700 shadow-lg flex items-center space-x-2 transition-transform transform hover:-translate-y-0.5">
                <i class="fa fa-plus"></i>
                <span>Report New Item</span>
            </a>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="border-b border-gray-700 mb-6">
        <nav class="flex space-x-4" aria-label="Tabs">
            <button @click="activeTab = 'reported'" 
                    :class="{ 'border-teal-400 text-white': activeTab === 'reported', 'border-transparent text-gray-400 hover:text-white hover:border-gray-500': activeTab !== 'reported' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition">
                My Reported Items
            </button>
            <button @click="activeTab = 'claimed'"
                    :class="{ 'border-teal-400 text-white': activeTab === 'claimed', 'border-transparent text-gray-400 hover:text-white hover:border-gray-500': activeTab !== 'claimed' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition">
                Successfully Claimed
            </button>
            <button @click="activeTab = 'alerts'"
                    :class="{ 'border-teal-400 text-white': activeTab === 'alerts', 'border-transparent text-gray-400 hover:text-white hover:border-gray-500': activeTab !== 'alerts' }"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition">
                My Lost Alerts
            </button>
        </nav>
    </div>

    <!-- Tab Content -->
    <div>
        <!-- My Reported Items Content -->
        <div x-show="activeTab === 'reported'" x-cloak>
            <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700">
                {% if my_items %}
                <ul class="divide-y divide-gray-700">
                    {% for item in my_items %}
                    <li class="p-4 sm:p-6 hover:bg-gray-700/50 transition">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <p class="text-lg font-semibold text-white truncate">{{ item.title }}</p>
                                <!-- UPDATED: Highlighted Lost/Found Badge -->
                                <div class="flex items-center text-sm text-gray-400 mt-1">
                                    <span class="px-2.5 py-1 inline-flex text-xs leading-4 font-semibold rounded-full 
                                    {% if item.item_type == 'found' %} bg-green-900/50 text-green-300 border border-green-500/30
                                    {% else %} bg-red-900/50 text-red-300 border border-red-500/30 {% endif %}">
                                        {{ item.item_type|capitalize }}
                                    </span>
                                    <span class="mx-2">&bull;</span>
                                    <span>{{ item.reported_at | bst }}</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                                {% if item.status == 'retrieved' %} bg-green-500/20 text-green-300
                                {% elif item.status == 'claimed' %} bg-yellow-500/20 text-yellow-300
                                {% else %} bg-blue-500/20 text-blue-300 {% endif %}">
                                    {{ item.status|capitalize }}
                                </span>
                                <a href="{{ url_for('item_details', item_id=item.id) }}" class="text-teal-400 hover:text-teal-300 font-semibold text-sm">View</a>
                                {% if item.status == 'retrieved' and not item.feedback_given %}
                                    <a href="{{ url_for('leave_feedback', item_id=item.id) }}" class="text-yellow-400 hover:text-yellow-300 font-semibold text-sm">Feedback</a>
                                {% endif %}
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="text-center py-16">
                    <i class="fa fa-box-open text-5xl text-gray-600"></i>
                    <p class="mt-4 text-lg text-gray-400">You have not reported any items yet.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Successfully Claimed Items Content -->
        <div x-show="activeTab === 'claimed'" x-cloak>
            <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700">
                {% if my_claims %}
                <ul class="divide-y divide-gray-700">
                    {% for claim in my_claims %}
                    <li class="p-4 sm:p-6 hover:bg-gray-700/50 transition">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <p class="text-lg font-semibold text-white truncate">{{ claim.item_title }}</p>
                                <p class="text-sm text-gray-400 mt-1">Claim approved on {{ claim.created_at | bst }}</p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <a href="{{ url_for('conversation', claim_id=claim.id) }}" class="text-blue-400 hover:text-blue-300 font-semibold text-sm">Conversation</a>
                                <a href="{{ url_for('item_details', item_id=claim.item_id) }}" class="text-teal-400 hover:text-teal-300 font-semibold text-sm">View Item</a>
                                {% if not claim.feedback_given %}
                                    <a href="{{ url_for('leave_feedback', item_id=claim.item_id) }}" class="text-yellow-400 hover:text-yellow-300 font-semibold text-sm">Feedback</a>
                                {% endif %}
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="text-center py-16">
                    <i class="fa fa-check-double text-5xl text-gray-600"></i>
                    <p class="mt-4 text-lg text-gray-400">You have not successfully claimed any items yet.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- My Lost Item Alerts Content -->
        <div x-show="activeTab === 'alerts'" x-cloak>
            <div class="bg-gray-800 rounded-lg shadow-xl border border-gray-700">
                {% if my_alerts %}
                <ul class="divide-y divide-gray-700">
                    {% for alert in my_alerts %}
                    <li class="p-4 sm:p-6 hover:bg-gray-700/50 transition">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <p class="text-lg font-semibold text-white truncate">{{ alert.title }}</p>
                                <p class="text-sm text-gray-400 mt-1">
                                    <span>Category: {{ alert.category_name }}</span> &bull;
                                    <span>Created on {{ alert.alert_date | bst }}</span>
                                </p>
                            </div>
                            <div class="flex items-center space-x-4">
                                <form action="{{ url_for('delete_lost_alert', alert_id=alert.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this alert?');">
                                    <button type="submit" class="text-red-400 hover:text-red-300 font-semibold text-sm">Delete</button>
                                </form>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="text-center py-16">
                    <i class="fa fa-bell-slash text-5xl text-gray-600"></i>
                    <p class="mt-4 text-lg text-gray-400">You have no active lost item alerts.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
